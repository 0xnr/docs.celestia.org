(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{600:function(t,e,a){"use strict";a.r(e);var d=a(0),s=Object(d.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"consensus-rules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consensus-rules"}},[t._v("#")]),t._v(" Consensus Rules")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#system-parameters"}},[t._v("System Parameters")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#units"}},[t._v("Units")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#constants"}},[t._v("Constants")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#reserved-namespace-ids"}},[t._v("Reserved Namespace IDs")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#reserved-state-subtree-ids"}},[t._v("Reserved State Subtree IDs")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#rewards-and-penalties"}},[t._v("Rewards and Penalties")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#leader-selection"}},[t._v("Leader Selection")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#fork-choice"}},[t._v("Fork Choice")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#block-validity"}},[t._v("Block Validity")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#block-structure"}},[t._v("Block Structure")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#blockheader"}},[a("code",[t._v("block.header")])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#blockavailabledataheader"}},[a("code",[t._v("block.availableDataHeader")])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#blocklastcommit"}},[a("code",[t._v("block.lastCommit")])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#blockavailabledata"}},[a("code",[t._v("block.availableData")])])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#state-transitions"}},[t._v("State Transitions")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#blockavailabledataevidencedata"}},[a("code",[t._v("block.availableData.evidenceData")])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#blockavailabledatatransactiondata"}},[a("code",[t._v("block.availableData.transactionData")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#signedtransactiondatatransfer"}},[t._v("SignedTransactionDataTransfer")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactiondatapayformessage"}},[t._v("SignedTransactionDataPayForMessage")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactiondatacreatevalidator"}},[t._v("SignedTransactionDataCreateValidator")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactiondatabeginunbondingvalidator"}},[t._v("SignedTransactionDataBeginUnbondingValidator")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactiondataunbondvalidator"}},[t._v("SignedTransactionDataUnbondValidator")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactiondatacreatedelegation"}},[t._v("SignedTransactionDataCreateDelegation")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactiondatabeginunbondingdelegation"}},[t._v("SignedTransactionDataBeginUnbondingDelegation")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactiondataunbonddelegation"}},[t._v("SignedTransactionDataUnbondDelegation")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactiondataburn"}},[t._v("SignedTransactionDataBurn")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactionredelegatecommission"}},[t._v("SignedTransactionRedelegateCommission")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#signedtransactionredelegatereward"}},[t._v("SignedTransactionRedelegateReward")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#begin-block"}},[t._v("Begin Block")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#end-block"}},[t._v("End Block")])])])])])])]),t._v(" "),a("h2",{attrs:{id:"system-parameters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#system-parameters"}},[t._v("#")]),t._v(" System Parameters")]),t._v(" "),a("h3",{attrs:{id:"units"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#units"}},[t._v("#")]),t._v(" Units")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("name")]),t._v(" "),a("th",[t._v("SI")]),t._v(" "),a("th",[t._v("value")]),t._v(" "),a("th",[t._v("description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("1u")])]),t._v(" "),a("td",[a("code",[t._v("1u")])]),t._v(" "),a("td",[a("code",[t._v("10**0")])]),t._v(" "),a("td",[a("code",[t._v("1")]),t._v(" unit.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("2u")])]),t._v(" "),a("td",[a("code",[t._v("k1u")])]),t._v(" "),a("td",[a("code",[t._v("10**3")])]),t._v(" "),a("td",[a("code",[t._v("1000")]),t._v(" units.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("3u")])]),t._v(" "),a("td",[a("code",[t._v("M1u")])]),t._v(" "),a("td",[a("code",[t._v("10**6")])]),t._v(" "),a("td",[a("code",[t._v("1000000")]),t._v(" units.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("4u")])]),t._v(" "),a("td",[a("code",[t._v("G1u")])]),t._v(" "),a("td",[a("code",[t._v("10**9")])]),t._v(" "),a("td",[a("code",[t._v("1000000000")]),t._v(" units.")])])])]),t._v(" "),a("h3",{attrs:{id:"constants"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#constants"}},[t._v("#")]),t._v(" Constants")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("name")]),t._v(" "),a("th",[t._v("type")]),t._v(" "),a("th",[t._v("value")]),t._v(" "),a("th",[t._v("unit")]),t._v(" "),a("th",[t._v("description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("AVAILABLE_DATA_ORIGINAL_SQUARE_MAX")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("share")])]),t._v(" "),a("td",[t._v("Maximum number of rows/columns of the original data "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#share"}},[t._v("shares")]),t._v(" in "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#arranging-available-data-into-shares"}},[t._v("square layout")]),t._v(".")],1)]),t._v(" "),a("tr",[a("td",[a("code",[t._v("AVAILABLE_DATA_ORIGINAL_SQUARE_TARGET")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("share")])]),t._v(" "),a("td",[t._v("Target number of rows/columns of the original data "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#share"}},[t._v("shares")]),t._v(" in "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#arranging-available-data-into-shares"}},[t._v("square layout")]),t._v(".")],1)]),t._v(" "),a("tr",[a("td",[a("code",[t._v("BLOCK_TIME")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("second")]),t._v(" "),a("td",[t._v("Block time, in seconds.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("CHAIN_ID")])]),t._v(" "),a("td",[a("code",[t._v("string")])]),t._v(" "),a("td",[a("code",[t._v('"Celestia"')])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Chain ID. Each chain assigns itself a (unique) ID.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("GENESIS_COIN_COUNT")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("10**8")])]),t._v(" "),a("td",[a("code",[t._v("4u")])]),t._v(" "),a("td",[a("code",[t._v("(= 100000000)")]),t._v(" Number of coins at genesis.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("MAX_GRAFFITI_BYTES")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("32")])]),t._v(" "),a("td",[a("code",[t._v("byte")])]),t._v(" "),a("td",[t._v("Maximum size of transaction graffiti, in bytes.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("MAX_VALIDATORS")])]),t._v(" "),a("td",[a("code",[t._v("uint16")])]),t._v(" "),a("td",[a("code",[t._v("64")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Maximum number of active validators.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("NAMESPACE_ID_BYTES")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("8")])]),t._v(" "),a("td",[a("code",[t._v("byte")])]),t._v(" "),a("td",[t._v("Size of namespace ID, in bytes.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("NAMESPACE_ID_MAX_RESERVED")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("255")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Value of maximum reserved namespace ID (inclusive). 1 byte worth of IDs.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SHARE_RESERVED_BYTES")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("1")])]),t._v(" "),a("td",[a("code",[t._v("byte")])]),t._v(" "),a("td",[t._v("Bytes reserved at the beginning of each "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#share"}},[t._v("share")]),t._v(". Must be sufficient to represent "),a("code",[t._v("SHARE_SIZE")]),t._v(".")],1)]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SHARE_SIZE")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("256")])]),t._v(" "),a("td",[a("code",[t._v("byte")])]),t._v(" "),a("td",[t._v("Size of transaction and message "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#share"}},[t._v("shares")]),t._v(", in bytes.")],1)]),t._v(" "),a("tr",[a("td",[a("code",[t._v("STATE_SUBTREE_RESERVED_BYTES")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("1")])]),t._v(" "),a("td",[a("code",[t._v("byte")])]),t._v(" "),a("td",[t._v("Number of bytes reserved to identify state subtrees.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("UNBONDING_DURATION")])]),t._v(" "),a("td",[a("code",[t._v("uint32")])]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("block")])]),t._v(" "),a("td",[t._v("Duration, in blocks, for unbonding a validator or delegation.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("VERSION_APP")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("1")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Version of the Celestia application. Breaking changes (hard forks) must update this parameter.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("VERSION_BLOCK")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("1")])]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Version of the Celestia chain. Breaking changes (hard forks) must update this parameter.")])])])]),t._v(" "),a("h3",{attrs:{id:"reserved-namespace-ids"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reserved-namespace-ids"}},[t._v("#")]),t._v(" Reserved Namespace IDs")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("name")]),t._v(" "),a("th",[t._v("type")]),t._v(" "),a("th",[t._v("value")]),t._v(" "),a("th",[t._v("description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("TRANSACTION_NAMESPACE_ID")])]),t._v(" "),a("td",[a("code",[t._v("NamespaceID")])]),t._v(" "),a("td",[a("code",[t._v("0x0000000000000001")])]),t._v(" "),a("td",[t._v("Transactions: requests that modify the state.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("INTERMEDIATE_STATE_ROOT_NAMESPACE_ID")])]),t._v(" "),a("td",[a("code",[t._v("NamespaceID")])]),t._v(" "),a("td",[a("code",[t._v("0x0000000000000002")])]),t._v(" "),a("td",[t._v("Intermediate state roots, committed after every transaction.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("EVIDENCE_NAMESPACE_ID")])]),t._v(" "),a("td",[a("code",[t._v("NamespaceID")])]),t._v(" "),a("td",[a("code",[t._v("0x0000000000000003")])]),t._v(" "),a("td",[t._v("Evidence: fraud proofs or other proof of slashable action.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("TAIL_TRANSACTION_PADDING_NAMESPACE_ID")])]),t._v(" "),a("td",[a("code",[t._v("NamespaceID")])]),t._v(" "),a("td",[a("code",[t._v("0x00000000000000FF")])]),t._v(" "),a("td",[t._v("Tail padding for transactions: padding after all transactions but before messages.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("TAIL_PADDING_NAMESPACE_ID")])]),t._v(" "),a("td",[a("code",[t._v("NamespaceID")])]),t._v(" "),a("td",[a("code",[t._v("0xFFFFFFFFFFFFFFFE")])]),t._v(" "),a("td",[t._v("Tail padding for messages: padding after all messages to fill up the original data square.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("PARITY_SHARE_NAMESPACE_ID")])]),t._v(" "),a("td",[a("code",[t._v("NamespaceID")])]),t._v(" "),a("td",[a("code",[t._v("0xFFFFFFFFFFFFFFFF")])]),t._v(" "),a("td",[t._v("Parity shares: extended shares in the available data matrix.")])])])]),t._v(" "),a("h3",{attrs:{id:"reserved-state-subtree-ids"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reserved-state-subtree-ids"}},[t._v("#")]),t._v(" Reserved State Subtree IDs")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("name")]),t._v(" "),a("th",[t._v("type")]),t._v(" "),a("th",[t._v("value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("ACCOUNTS_SUBTREE_ID")])]),t._v(" "),a("td",[a("code",[t._v("StateSubtreeID")])]),t._v(" "),a("td",[a("code",[t._v("0x01")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ACTIVE_VALIDATORS_SUBTREE_ID")])]),t._v(" "),a("td",[a("code",[t._v("StateSubtreeID")])]),t._v(" "),a("td",[a("code",[t._v("0x02")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("INACTIVE_VALIDATORS_SUBTREE_ID")])]),t._v(" "),a("td",[a("code",[t._v("StateSubtreeID")])]),t._v(" "),a("td",[a("code",[t._v("0x03")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DELEGATIONS_SUBTREE_ID")])]),t._v(" "),a("td",[a("code",[t._v("StateSubtreeID")])]),t._v(" "),a("td",[a("code",[t._v("0x04")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("MESSAGE_PAID_SUBTREE_ID")])]),t._v(" "),a("td",[a("code",[t._v("StateSubtreeID")])]),t._v(" "),a("td",[a("code",[t._v("0x05")])])])])]),t._v(" "),a("h3",{attrs:{id:"rewards-and-penalties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rewards-and-penalties"}},[t._v("#")]),t._v(" Rewards and Penalties")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("name")]),t._v(" "),a("th",[t._v("type")]),t._v(" "),a("th",[t._v("value")]),t._v(" "),a("th",[t._v("unit")]),t._v(" "),a("th",[t._v("description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("SECONDS_PER_YEAR")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("31536000")])]),t._v(" "),a("td",[t._v("second")]),t._v(" "),a("td",[t._v("Seconds per year. Omit leap seconds.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("TARGET_ANNUAL_ISSUANCE")])]),t._v(" "),a("td",[a("code",[t._v("uint64")])]),t._v(" "),a("td",[a("code",[t._v("2 * 10**6")])]),t._v(" "),a("td",[a("code",[t._v("4u")])]),t._v(" "),a("td",[a("code",[t._v("(= 2000000)")]),t._v(" Target number of coins to issue per year.")])])])]),t._v(" "),a("h2",{attrs:{id:"leader-selection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#leader-selection"}},[t._v("#")]),t._v(" Leader Selection")]),t._v(" "),a("p",[t._v("TODO")]),t._v(" "),a("h2",{attrs:{id:"fork-choice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fork-choice"}},[t._v("#")]),t._v(" Fork Choice")]),t._v(" "),a("p",[t._v("The Tendermint consensus protocol is fork-free by construction under an honest majority of stake assumption.")]),t._v(" "),a("p",[t._v("If a block has a "),a("a",{attrs:{href:"#blocklastcommit"}},[t._v("valid commit")]),t._v(", it is part of the canonical chain. If equivocation "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#evidence"}},[t._v("evidence")]),t._v(" is detected for more than 1/3 of voting power, the node must halt. See "),a("RouterLink",{attrs:{to:"/rationale/fork_choice_das.html"}},[t._v("rationale doc")]),t._v(" for more information.")],1),t._v(" "),a("h2",{attrs:{id:"block-validity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-validity"}},[t._v("#")]),t._v(" Block Validity")]),t._v(" "),a("p",[t._v("The validity of a newly-seen block, "),a("code",[t._v("block")]),t._v(", is determined by two components, detailed in subsequent sections:")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"#block-structure"}},[t._v("Block structure")]),t._v(": whether the block header is valid, and data in a block is arranged into a valid and matching data root (i.e. syntax).")]),t._v(" "),a("li",[a("a",{attrs:{href:"#state-transitions"}},[t._v("State transition")]),t._v(": whether the application of transactions in the block produces a matching and valid state root (i.e. semantics).")])]),t._v(" "),a("p",[t._v("Pseudocode in this section is not in any specific language and should be interpreted as being in a neutral and sane language.")]),t._v(" "),a("h2",{attrs:{id:"block-structure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-structure"}},[t._v("#")]),t._v(" Block Structure")]),t._v(" "),a("p",[t._v("Before executing "),a("a",{attrs:{href:"#state-transitions"}},[t._v("state transitions")]),t._v(", the structure of the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#block"}},[t._v("block")]),t._v(" must be verified.")],1),t._v(" "),a("p",[t._v("The following block fields are acquired from the network and parsed (i.e. "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#serialization"}},[t._v("deserialized")]),t._v("). If they cannot be parsed, the block is ignored but is not explicitly considered invalid by consensus rules. Further implications of ignoring a block are found in the "),a("RouterLink",{attrs:{to:"/specs/networking.html"}},[t._v("networking spec")]),t._v(".")],1),t._v(" "),a("ol",[a("li",[a("RouterLink",{attrs:{to:"/specs/data_structures.html#header"}},[t._v("block.header")])],1),t._v(" "),a("li",[a("RouterLink",{attrs:{to:"/specs/data_structures.html#availabledataheader"}},[t._v("block.availableDataHeader")])],1),t._v(" "),a("li",[a("RouterLink",{attrs:{to:"/specs/data_structures.html#commit"}},[t._v("block.lastCommit")])],1)]),t._v(" "),a("p",[t._v("If the above fields are parsed successfully, the available data "),a("code",[t._v("block.availableData")]),t._v(" is acquired in erasure-coded form as "),a("RouterLink",{attrs:{to:"/specs/networking.html#availabledata"}},[t._v("a list of share rows")]),t._v(", then parsed. If it cannot be parsed, the block is ignored but not explicitly invalid, as above.")],1),t._v(" "),a("h3",{attrs:{id:"block-header"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-header"}},[t._v("#")]),t._v(" "),a("code",[t._v("block.header")])]),t._v(" "),a("p",[t._v("The "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#header"}},[t._v("block header")]),t._v(" "),a("code",[t._v("block.header")]),t._v(" ("),a("code",[t._v("header")]),t._v(" for short) is the first thing that is downloaded from the new block, and commits to everything inside the block in some way. For previous block "),a("code",[t._v("prev")]),t._v(" (if "),a("code",[t._v("prev")]),t._v(" is not known, then the block is ignored), and previous block header "),a("code",[t._v("prev.header")]),t._v(", the following checks must be "),a("code",[t._v("true")]),t._v(":")],1),t._v(" "),a("p",[a("code",[t._v("availableDataOriginalSquareSize")]),t._v(" is computed as described "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#header"}},[t._v("here")]),t._v(".")],1),t._v(" "),a("ol",[a("li",[a("code",[t._v("header.height")]),t._v(" == "),a("code",[t._v("prev.header.height + 1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("header.timestamp")]),t._v(" > "),a("code",[t._v("prev.header.timestamp")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("header.lastHeaderHash")]),t._v(" == the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#header"}},[t._v("header hash")]),t._v(" of "),a("code",[t._v("prev")]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("header.lastCommitHash")]),t._v(" == the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#hashing"}},[t._v("hash")]),t._v(" of "),a("code",[t._v("lastCommit")]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("header.consensusHash")]),t._v(" == the value computed "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#consensus-parameters"}},[t._v("here")]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("header.stateCommitment")]),t._v(" == the root of the state, computed "),a("a",{attrs:{href:"#state-transitions"}},[t._v("with the application of all state transitions in this block")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("availableDataOriginalSquareSize")]),t._v(" <= "),a("a",{attrs:{href:"#constants"}},[a("code",[t._v("AVAILABLE_DATA_ORIGINAL_SQUARE_MAX")])]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("header.availableDataRoot")]),t._v(" == the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#binary-merkle-tree"}},[t._v("Merkle root")]),t._v(" of the tree with the row and column roots of "),a("code",[t._v("block.availableDataHeader")]),t._v(" as leaves.")],1),t._v(" "),a("li",[a("code",[t._v("header.proposerAddress")]),t._v(" == the "),a("a",{attrs:{href:"#leader-selection"}},[t._v("leader")]),t._v(" for "),a("code",[t._v("header.height")]),t._v(".")])]),t._v(" "),a("h3",{attrs:{id:"block-availabledataheader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-availabledataheader"}},[t._v("#")]),t._v(" "),a("code",[t._v("block.availableDataHeader")])]),t._v(" "),a("p",[t._v("The "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#availabledataheader"}},[t._v("available data header")]),t._v(") "),a("code",[t._v("block.availableDataHeader")]),t._v(" ("),a("code",[t._v("availableDataHeader")]),t._v(" for short) is then processed. This commits to the available data, which is only downloaded after the "),a("a",{attrs:{href:"#blocklastcommit"}},[t._v("consensus commit")]),t._v(" is processed. The following checks must be "),a("code",[t._v("true")]),t._v(":")],1),t._v(" "),a("ol",[a("li",[t._v("Length of "),a("code",[t._v("availableDataHeader.rowRoots")]),t._v(" == "),a("code",[t._v("availableDataOriginalSquareSize * 2")]),t._v(".")]),t._v(" "),a("li",[t._v("Length of "),a("code",[t._v("availableDataHeader.colRoots")]),t._v(" == "),a("code",[t._v("availableDataOriginalSquareSize * 2")]),t._v(".")]),t._v(" "),a("li",[t._v("The length of each element in "),a("code",[t._v("availableDataHeader.rowRoots")]),t._v(" and "),a("code",[t._v("availableDataHeader.colRoots")]),t._v(" must be "),a("RouterLink",{attrs:{to:"/specs/consensus.html#hashing"}},[a("code",[t._v("32")])]),t._v(".")],1)]),t._v(" "),a("h3",{attrs:{id:"block-lastcommit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-lastcommit"}},[t._v("#")]),t._v(" "),a("code",[t._v("block.lastCommit")])]),t._v(" "),a("p",[t._v("The last "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#commit"}},[t._v("commit")]),t._v(" "),a("code",[t._v("block.lastCommit")]),t._v(" ("),a("code",[t._v("lastCommit")]),t._v(" for short) is processed next. This is the Tendermint commit (i.e. polka of votes) "),a("em",[t._v("for the previous block")]),t._v(". For previous block "),a("code",[t._v("prev")]),t._v(" and previous block header "),a("code",[t._v("prev.header")]),t._v(", the following checks must be "),a("code",[t._v("true")]),t._v(":")],1),t._v(" "),a("ol",[a("li",[a("code",[t._v("lastCommit.height")]),t._v(" == "),a("code",[t._v("prev.header.height")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("lastCommit.round")]),t._v(" >= "),a("code",[t._v("1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("lastCommit.headerHash")]),t._v(" == the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#header"}},[t._v("header hash")]),t._v(" of "),a("code",[t._v("prev")]),t._v(".")],1),t._v(" "),a("li",[t._v("Length of "),a("code",[t._v("lastCommit.signatures")]),t._v(" <= "),a("a",{attrs:{href:"#constants"}},[a("code",[t._v("MAX_VALIDATORS")])]),t._v(".")]),t._v(" "),a("li",[t._v("Each of "),a("code",[t._v("lastCommit.signatures")]),t._v(" must be a valid "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#commitsig"}},[t._v("CommitSig")])],1),t._v(" "),a("li",[t._v("The sum of the votes for "),a("code",[t._v("prev")]),t._v(" in "),a("code",[t._v("lastCommit")]),t._v(" must be at least 2/3 (rounded up) of the voting power of "),a("code",[t._v("prev")]),t._v("'s next validator set.")])]),t._v(" "),a("h3",{attrs:{id:"block-availabledata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-availabledata"}},[t._v("#")]),t._v(" "),a("code",[t._v("block.availableData")])]),t._v(" "),a("p",[t._v("The block's "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#availabledata"}},[t._v("available data")]),t._v(" (analogous to transactions in contemporary blockchain designs) "),a("code",[t._v("block.availableData")]),t._v(" ("),a("code",[t._v("availableData")]),t._v(" for short) is finally processed. The "),a("RouterLink",{attrs:{to:"/specs/networking.html#availabledata"}},[t._v("list of share rows")]),t._v(" is parsed into the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#availabledata"}},[t._v("actual data structures")]),t._v(" using the reverse of "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#arranging-available-data-into-shares"}},[t._v("the process to encode available data into shares")]),t._v("; if parsing fails here, the block is invalid.")],1),t._v(" "),a("p",[t._v("Once parsed, the following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[t._v("The commitments of the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#2d-reed-solomon-encoding-scheme"}},[t._v("erasure-coded extended")]),t._v(" "),a("code",[t._v("availableData")]),t._v(" must match those in "),a("code",[t._v("header.availableDataHeader")]),t._v(". Implicitly, this means that both rows and columns must be ordered lexicographically by namespace ID since they are committed to in a "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#namespace-merkle-tree"}},[t._v("Namespace Merkle Tree")]),t._v(".")],1),t._v(" "),a("li",[t._v("Length of "),a("code",[t._v("availableData.intermediateStateRootData")]),t._v(" == length of "),a("code",[t._v("availableData.transactionData")]),t._v(" + length of "),a("code",[t._v("availableData.evidenceData")]),t._v(" + 2. (Two additional state transitions are the "),a("a",{attrs:{href:"#begin-block"}},[t._v("begin")]),t._v(" and "),a("a",{attrs:{href:"#end-block"}},[t._v("end block")]),t._v(" implicit transitions.)")])]),t._v(" "),a("h2",{attrs:{id:"state-transitions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#state-transitions"}},[t._v("#")]),t._v(" State Transitions")]),t._v(" "),a("p",[t._v("Once the basic structure of the block "),a("a",{attrs:{href:"#block-structure"}},[t._v("has been validated")]),t._v(", state transitions must be applied to compute the new state and state root.")]),t._v(" "),a("p",[t._v("For this section, the variable "),a("code",[t._v("state")]),t._v(" represents the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#state"}},[t._v("state tree")]),t._v(", with "),a("code",[t._v("state.accounts[k]")]),t._v(", "),a("code",[t._v("state.inactiveValidatorSet[k]")]),t._v(", "),a("code",[t._v("state.activeValidatorSet[k]")]),t._v(", and "),a("code",[t._v("state.delegationSet[k]")]),t._v(" being shorthand for the leaf in the state tree in the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#state"}},[t._v("accounts, inactive validator set, active validator set, and delegation set subtrees")]),t._v(" with "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#state"}},[t._v("pre-hashed key")]),t._v(" "),a("code",[t._v("k")]),t._v(". E.g. "),a("code",[t._v("state.accounts[a]")]),t._v(" is shorthand for "),a("code",[t._v("state[(ACCOUNTS_SUBTREE_ID << 8*(32-STATE_SUBTREE_RESERVED_BYTES)) | ((-1 >> 8*STATE_SUBTREE_RESERVED_BYTES) & hash(a))]")]),t._v(".")],1),t._v(" "),a("p",[t._v("State transitions are applied in the following order:")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"#begin-block"}},[t._v("Begin block")]),t._v(".")]),t._v(" "),a("li",[a("a",{attrs:{href:"#blockavailabledataevidencedata"}},[t._v("Evidence")]),t._v(".")]),t._v(" "),a("li",[a("a",{attrs:{href:"#blockavailabledatatransactiondata"}},[t._v("Transactions")]),t._v(".")]),t._v(" "),a("li",[a("a",{attrs:{href:"#end-block"}},[t._v("End block")]),t._v(".")])]),t._v(" "),a("h3",{attrs:{id:"block-availabledata-evidencedata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-availabledata-evidencedata"}},[t._v("#")]),t._v(" "),a("code",[t._v("block.availableData.evidenceData")])]),t._v(" "),a("p",[t._v("Evidence is the second set of state transitions that are applied, ahead of "),a("a",{attrs:{href:"#blockavailabledatatransactiondata"}},[t._v("transactions")]),t._v(".\nEach evidence represents proof of validator misbehavior, and causes a penalty against the validator(s).")]),t._v(" "),a("h3",{attrs:{id:"block-availabledata-transactiondata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-availabledata-transactiondata"}},[t._v("#")]),t._v(" "),a("code",[t._v("block.availableData.transactionData")])]),t._v(" "),a("p",[t._v("Once "),a("a",{attrs:{href:"#blockavailabledataevidencedata"}},[t._v("evidence has been processed")]),t._v(", transactions are applied to the state. Note that "),a("em",[t._v("transactions")]),t._v(" mutate the state (essentially, the validator set and minimal balances), while "),a("em",[t._v("messages")]),t._v(" do not. See "),a("RouterLink",{attrs:{to:"/specs/architecture.html"}},[t._v("the architecture documentation")]),t._v(" for more info.")],1),t._v(" "),a("p",[a("code",[t._v("block.availableData.transactionData")]),t._v(" is simply a list of "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#wrappedtransaction"}},[t._v("WrappedTransaction")]),t._v("s. For each wrapped transaction in this list, "),a("code",[t._v("wrappedTransaction")]),t._v(", with index "),a("code",[t._v("i")]),t._v(" (starting from "),a("code",[t._v("0")]),t._v("), the following checks must be "),a("code",[t._v("true")]),t._v(":")],1),t._v(" "),a("ol",[a("li",[a("code",[t._v("wrappedTransaction.index")]),t._v(" == "),a("code",[t._v("i")]),t._v(".")])]),t._v(" "),a("p",[t._v("For "),a("code",[t._v("wrappedTransaction")]),t._v("'s "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#transaction"}},[t._v("transaction")]),t._v(" "),a("code",[t._v("transaction")]),t._v(", the following checks must be "),a("code",[t._v("true")]),t._v(":")],1),t._v(" "),a("ol",[a("li",[a("code",[t._v("transaction.signature")]),t._v(" must be a "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#public-key-cryptography"}},[t._v("valid signature")]),t._v(" over "),a("code",[t._v("transaction.signedTransactionData")]),t._v(".")],1)]),t._v(" "),a("p",[t._v("Finally, each "),a("code",[t._v("wrappedTransaction")]),t._v(" is processed depending on "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[t._v("its transaction type")]),t._v(". These are specified in the next subsections, where "),a("code",[t._v("tx")]),t._v(" is short for "),a("code",[t._v("transaction.signedTransactionData")]),t._v(", and "),a("code",[t._v("sender")]),t._v(" is the recovered signing "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#address"}},[t._v("address")]),t._v(". We will define a few helper functions:")],1),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"dGlwQ29zdCh5LCB6KSA9IHkgKiB6CnRvdGFsQ29zdCh4LCB5LCB6KSA9IHggKyB0aXBDb3N0KHksIHopCg=="}}),t._v(" "),a("p",[t._v(", where "),a("code",[t._v("x")]),t._v(" above is the amount of coins sent by the transaction authorizer, "),a("code",[t._v("y")]),t._v(" above is the tip rate set in the transaction, and "),a("code",[t._v("z")]),t._v(" above is the measure of the block space used by the transaction (i.e. size in bytes).")]),t._v(" "),a("p",[t._v("Four additional helper functions are defined to manage the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#validator"}},[t._v("validator queue")]),t._v(":")],1),t._v(" "),a("ol",[a("li",[a("code",[t._v("findFromQueue(power)")]),t._v(", which returns the address of the last validator in the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#validator"}},[t._v("validator queue")]),t._v(" with voting power greater than or equal to "),a("code",[t._v("power")]),t._v(", or "),a("code",[t._v("0")]),t._v(" if the queue is empty or no validators in the queue have at least "),a("code",[t._v("power")]),t._v(" voting power.")],1),t._v(" "),a("li",[a("code",[t._v("parentFromQueue(address)")]),t._v(", which returns the address of the parent in the validator queue of the validator with address "),a("code",[t._v("address")]),t._v(", or "),a("code",[t._v("0")]),t._v(" if "),a("code",[t._v("address")]),t._v(" is not in the queue or is the head of the queue.")]),t._v(" "),a("li",[a("code",[t._v("validatorQueueInsert")]),t._v(", defined as")])]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"ZnVuY3Rpb24gdmFsaWRhdG9yUXVldWVJbnNlcnQodmFsaWRhdG9yKQogICAgIyBJbnNlcnQgdGhlIG5ldyB2YWxpZGF0b3IgaW50byB0aGUgbGlua2VkIGxpc3QKICAgIHBhcmVudCA9IGZpbmRGcm9tUXVldWUodmFsaWRhdG9yLnZvdGluZ1Bvd2VyKQogICAgaWYgcGFyZW50ICE9IDAKICAgICAgICBpZiBzdGF0ZS5hY2NvdW50c1twYXJlbnRdLnN0YXR1cyA9PSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvckJvbmRlZAogICAgICAgICAgICB2YWxpZGF0b3IubmV4dCA9IHN0YXRlLmFjdGl2ZVZhbGlkYXRvclNldFtwYXJlbnRdLm5leHQKICAgICAgICAgICAgc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0W3BhcmVudF0ubmV4dCA9IHNlbmRlcgogICAgICAgIGVsc2UKICAgICAgICAgICAgdmFsaWRhdG9yLm5leHQgPSBzdGF0ZS5pbmFjdGl2ZVZhbGlkYXRvclNldFtwYXJlbnRdLm5leHQKICAgICAgICAgICAgc3RhdGUuaW5hY3RpdmVWYWxpZGF0b3JTZXRbcGFyZW50XS5uZXh0ID0gc2VuZGVyCiAgICBlbHNlCiAgICAgICAgdmFsaWRhdG9yLm5leHQgPSBzdGF0ZS52YWxpZGF0b3JRdWV1ZUhlYWQKICAgICAgICBzdGF0ZS52YWxpZGF0b3JRdWV1ZUhlYWQgPSBzZW5kZXIK"}}),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[a("code",[t._v("validatorQueueRemove")]),t._v(", defined as")])]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"ZnVuY3Rpb24gdmFsaWRhdG9yUXVldWVSZW1vdmUodmFsaWRhdG9yLCBzZW5kZXIpCiAgICAjIFJlbW92ZSBleGlzdGluZyB2YWxpZGF0b3IgZnJvbSB0aGUgbGlua2VkIGxpc3QKICAgIHBhcmVudCA9IHBhcmVudEZyb21RdWV1ZShzZW5kZXIpCiAgICBpZiBwYXJlbnQgIT0gMAogICAgICAgIGlmIHN0YXRlLmFjY291bnRzW3BhcmVudF0uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yQm9uZGVkCiAgICAgICAgICAgIHN0YXRlLmFjdGl2ZVZhbGlkYXRvclNldFtwYXJlbnRdLm5leHQgPSB2YWxpZGF0b3IubmV4dAogICAgICAgICAgICB2YWxpZGF0b3IubmV4dCA9IDAKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0YXRlLmluYWN0aXZlVmFsaWRhdG9yU2V0W3BhcmVudF0ubmV4dCA9IHZhbGlkYXRvci5uZXh0CiAgICAgICAgICAgIHZhbGlkYXRvci5uZXh0ID0gMAogICAgZWxzZQogICAgICAgIHN0YXRlLnZhbGlkYXRvclF1ZXVlSGVhZCA9IHZhbGlkYXRvci5uZXh0CiAgICAgICAgdmFsaWRhdG9yLm5leHQgPSAwCg=="}}),t._v(" "),a("p",[t._v("Note that light clients cannot perform a linear search through a linked list, and are instead provided logarithmic proofs (e.g. in the case of "),a("code",[t._v("parentFromQueue")]),t._v(", a proof to the parent is provided, which should have "),a("code",[t._v("address")]),t._v(" as its next validator).")]),t._v(" "),a("p",[t._v("In addition, three helper functions to manage the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#messagepaid"}},[t._v("message paid list")]),t._v(":")],1),t._v(" "),a("ol",[a("li",[a("code",[t._v("findFromMessagePaidList(start)")]),t._v(", which returns the transaction ID of the last transaction in the "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#messagepaid"}},[t._v("message paid list")]),t._v(" with "),a("code",[t._v("finish")]),t._v(" greater than "),a("code",[t._v("start")]),t._v(", or "),a("code",[t._v("0")]),t._v(" if the list is empty or no transactions in the list have at least "),a("code",[t._v("start")]),t._v(" "),a("code",[t._v("finish")]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("parentFromMessagePaidList(txid)")]),t._v(", which returns the transaction ID of the parent in the message paid list of the transaction with ID "),a("code",[t._v("txid")]),t._v(", or "),a("code",[t._v("0")]),t._v(" if "),a("code",[t._v("txid")]),t._v(" is not in the list or is the head of the list.")]),t._v(" "),a("li",[a("code",[t._v("messagePaidListInsert")]),t._v(", defined as")])]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"ZnVuY3Rpb24gbWVzc2FnZVBhaWRMaXN0SW5zZXJ0KHR4LCB0eGlkKQogICAgIyBJbnNlcnQgdGhlIG5ldyB0cmFuc2FjdGlvbiBpbnRvIHRoZSBsaW5rZWQgbGlzdAogICAgcGFyZW50ID0gZmluZEZyb21NZXNzYWdlUGFpZExpc3QodHgubWVzc2FnZVN0YXJ0SW5kZXgpCiAgICBzdGF0ZS5tZXNzYWdlc1BhaWRbdHhpZF0uc3RhcnQgPSB0eC5tZXNzYWdlU3RhcnRJbmRleAogICAgbnVtU2hhcmVzID0gY2VpbCh0eC5tZXNzYWdlU2l6ZSAvIFNIQVJFX1NJWkUpCiAgICBzdGF0ZS5tZXNzYWdlc1BhaWRbdHhpZF0uZmluaXNoID0gdHgubWVzc2FnZVN0YXJ0SW5kZXggKyBudW1TaGFyZXMgLSAxCiAgICBpZiBwYXJlbnQgIT0gMAogICAgICAgIHN0YXRlLm1lc3NhZ2VzUGFpZFt0eGlkXS5uZXh0ID0gc3RhdGUubWVzc2FnZXNQYWlkW3BhcmVudF0ubmV4dAogICAgICAgIHN0YXRlLm1lc3NhZ2VzUGFpZFtwYXJlbnRdLm5leHQgPSB0eGlkCiAgICBlbHNlCiAgICAgICAgc3RhdGUubWVzc2FnZXNQYWlkW3R4aWRdLm5leHQgPSBzdGF0ZS5tZXNzYWdlUGFpZEhlYWQKICAgICAgICBzdGF0ZS5tZXNzYWdlUGFpZEhlYWQgPSB0eGlkCg=="}}),t._v(" "),a("p",[t._v("We define a helper function to compute "),a("RouterLink",{attrs:{to:"/rationale/distributing_rewards.html"}},[t._v("F1 entries")]),t._v(":")],1),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"ZnVuY3Rpb24gY29tcHV0ZV9uZXdfZW50cnkocmV3YXJkLCBwb3dlcikKICAgIGlmIHBvd2VyID09IDAKICAgICAgICByZXR1cm4gMAogICAgcmV0dXJuIHJld2FyZCAvLyBwb3dlcgo="}}),t._v(" "),a("p",[t._v("After applying a transaction, the new state state root is computed.")]),t._v(" "),a("h4",{attrs:{id:"signedtransactiondatatransfer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactiondatatransfer"}},[t._v("#")]),t._v(" SignedTransactionDataTransfer")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.Transfer")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(tx.amount, tx.fee.tipRate, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"c3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCgpzdGF0ZS5hY2NvdW50c1tzZW5kZXJdLmJhbGFuY2UgLT0gdG90YWxDb3N0KHR4LmFtb3VudCwgdHguZmVlLnRpcFJhdGUsIGJ5dGVzUGFpZCkKc3RhdGUuYWNjb3VudHNbdHgudG9dLmJhbGFuY2UgKz0gdHguYW1vdW50CgpzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQucHJvcG9zZXJCbG9ja1Jld2FyZCArPSB0aXBDb3N0KGJ5dGVzUGFpZCkK"}}),t._v(" "),a("h4",{attrs:{id:"signedtransactiondatapayformessage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactiondatapayformessage"}},[t._v("#")]),t._v(" SignedTransactionDataPayForMessage")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KSArIHR4Lm1lc3NhZ2VTaXplCmN1cnJlbnRTdGFydEZpbmlzaCA9IHN0YXRlLm1lc3NhZ2VzUGFpZFtmaW5kRnJvbU1lc3NhZ2VQYWlkTGlzdCh0eC5tZXNzYWdlU3RhcnRJbmRleCldCnBhcmVudFN0YXJ0RmluaXNoID0gc3RhdGUubWVzc2FnZXNQYWlkW3BhcmVudEZyb21NZXNzYWdlUGFpZExpc3QoZmluZEZyb21NZXNzYWdlUGFpZExpc3QodHgubWVzc2FnZVN0YXJ0SW5kZXgpKV0K"}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.PayForMessage")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(0, tx.fee.tipRate, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")]),t._v(" "),a("li",[t._v("The "),a("code",[t._v("ceil(tx.messageSize / SHARE_SIZE)")]),t._v(" shares starting at index "),a("code",[t._v("tx.messageStartIndex")]),t._v(" must:\n"),a("ol",[a("li",[t._v("Have namespace ID "),a("code",[t._v("tx.messageNamespaceID")]),t._v(".")])])]),t._v(" "),a("li",[a("code",[t._v("tx.messageShareCommitment")]),t._v(" == computed as described "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondatapayformessage"}},[t._v("here")]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("parentStartFinish.finish")]),t._v(" < "),a("code",[t._v("tx.messageStartIndex")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("currentStartFinish.start")]),t._v(" == "),a("code",[t._v("0")]),t._v(" or "),a("code",[t._v("currentStartFinish.start")]),t._v(" > "),a("code",[t._v("tx.messageStartIndex + ceil(tx.messageSize / SHARE_SIZE)")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"c3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uYmFsYW5jZSAtPSB0b3RhbENvc3QodHguYW1vdW50LCB0eC5mZWUudGlwUmF0ZSwgYnl0ZXNQYWlkKQoKbWVzc2FnZVBhaWRMaXN0SW5zZXJ0KHR4LCBpZCh0eCkpCgpzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQucHJvcG9zZXJCbG9ja1Jld2FyZCArPSB0aXBDb3N0KHR4LmZlZS50aXBSYXRlLCBieXRlc1BhaWQpCg=="}}),t._v(" "),a("h4",{attrs:{id:"signedtransactiondatacreatevalidator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactiondatacreatevalidator"}},[t._v("#")]),t._v(" SignedTransactionDataCreateValidator")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.CreateValidator")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(0, tx.fee.tipRate, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.commissionRate.denominator > 0")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.commissionRate.numerator <= tx.commissionRate.denominator")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[sender].status")]),t._v(" == "),a("code",[t._v("AccountStatus.None")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"c3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uYmFsYW5jZSAtPSB0b3RhbENvc3QoMCwgdHguZmVlLnRpcFJhdGUsIGJ5dGVzUGFpZCkKc3RhdGUuYWNjb3VudHNbc2VuZGVyXS5zdGF0dXMgPSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvclF1ZXVlZAoKdmFsaWRhdG9yID0gbmV3IFZhbGlkYXRvcgp2YWxpZGF0b3IuY29tbWlzc2lvblJhdGUgPSB0eC5jb21taXNzaW9uUmF0ZQp2YWxpZGF0b3IuZGVsZWdhdGVkQ291bnQgPSAwCnZhbGlkYXRvci52b3RpbmdQb3dlciA9IDAKdmFsaWRhdG9yLnBlbmRpbmdSZXdhcmRzID0gMAp2YWxpZGF0b3IubGF0ZXN0RW50cnkgPSBQZXJpb2RFbnRyeSgwKQp2YWxpZGF0b3IudW5ib25kaW5nSGVpZ2h0ID0gMAp2YWxpZGF0b3IuaXNTbGFzaGVkID0gZmFsc2UKCnZhbGlkYXRvclF1ZXVlSW5zZXJ0KHZhbGlkYXRvcikKCnN0YXRlLmluYWN0aXZlVmFsaWRhdG9yU2V0W3NlbmRlcl0gPSB2YWxpZGF0b3IKCnN0YXRlLmFjdGl2ZVZhbGlkYXRvclNldC5wcm9wb3NlckJsb2NrUmV3YXJkICs9IHRpcENvc3QodHguZmVlLnRpcFJhdGUsIGJ5dGVzUGFpZCkK"}}),t._v(" "),a("h4",{attrs:{id:"signedtransactiondatabeginunbondingvalidator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactiondatabeginunbondingvalidator"}},[t._v("#")]),t._v(" SignedTransactionDataBeginUnbondingValidator")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.BeginUnbondingValidator")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(0, tx.fee.tipRate, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[sender].status")]),t._v(" == "),a("code",[t._v("AccountStatus.ValidatorQueued")]),t._v(" or "),a("code",[t._v("state.accounts[sender].status")]),t._v(" == "),a("code",[t._v("AccountStatus.ValidatorBonded")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"c3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uYmFsYW5jZSAtPSB0b3RhbENvc3QoMCwgdHguZmVlLnRpcFJhdGUsIGJ5dGVzUGFpZCkKc3RhdGUuYWNjb3VudHNbc2VuZGVyXS5zdGF0dXMgPSBWYWxpZGF0b3JTdGF0dXMuVW5ib25kaW5nCgppZiBzdGF0ZS5hY2NvdW50c1tzZW5kZXJdLnN0YXR1cyA9PSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvclF1ZXVlZAogICAgdmFsaWRhdG9yID0gc3RhdGUuaW5hY3RpdmVWYWxpZGF0b3JTZXRbc2VuZGVyXQplbHNlIGlmIHN0YXRlLmFjY291bnRzW3NlbmRlcl0uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yQm9uZGVkCiAgICB2YWxpZGF0b3IgPSBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXRbc2VuZGVyXQogICAgZGVsZXRlIHN0YXRlLmFjdGl2ZVZhbGlkYXRvclNldFtzZW5kZXJdCgp2YWxpZGF0b3IudW5ib25kaW5nSGVpZ2h0ID0gYmxvY2suaGVpZ2h0ICsgMQp2YWxpZGF0b3IubGF0ZXN0RW50cnkgKz0gY29tcHV0ZV9uZXdfZW50cnkodmFsaWRhdG9yLnBlbmRpbmdSZXdhcmRzLCB2YWxpZGF0b3Iudm90aW5nUG93ZXIpCnZhbGlkYXRvci5wZW5kaW5nUmV3YXJkcyA9IDAKCnZhbGlkYXRvclF1ZXVlUmVtb3ZlKHZhbGlkYXRvciwgc2VuZGVyKQoKc3RhdGUuaW5hY3RpdmVWYWxpZGF0b3JTZXRbc2VuZGVyXSA9IHZhbGlkYXRvcgoKc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0LmFjdGl2ZVZvdGluZ1Bvd2VyIC09IHZhbGlkYXRvci52b3RpbmdQb3dlcgoKc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0LnByb3Bvc2VyQmxvY2tSZXdhcmQgKz0gdGlwQ29zdCh0eC5mZWUudGlwUmF0ZSwgYnl0ZXNQYWlkKQo="}}),t._v(" "),a("h4",{attrs:{id:"signedtransactiondataunbondvalidator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactiondataunbondvalidator"}},[t._v("#")]),t._v(" SignedTransactionDataUnbondValidator")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.UnbondValidator")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(0, tx.fee.tipRate, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[sender].status")]),t._v(" == "),a("code",[t._v("AccountStatus.ValidatorUnbonding")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.inactiveValidatorSet[sender].unbondingHeight + UNBONDING_DURATION")]),t._v(" < "),a("code",[t._v("block.height")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"dmFsaWRhdG9yID0gc3RhdGUuaW5hY3RpdmVWYWxpZGF0b3JTZXRbc2VuZGVyXQoKc3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uYmFsYW5jZSAtPSB0b3RhbENvc3QoMCwgdHguZmVlLnRpcFJhdGUsIGJ5dGVzUGFpZCkKc3RhdGUuYWNjb3VudHNbc2VuZGVyXS5zdGF0dXMgPSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvclVuYm9uZGVkCgpzdGF0ZS5hY2NvdW50c1tzZW5kZXJdLmJhbGFuY2UgKz0gdmFsaWRhdG9yLmNvbW1pc3Npb25SZXdhcmRzCgpzdGF0ZS5pbmFjdGl2ZVZhbGlkYXRvclNldFtzZW5kZXJdID0gdmFsaWRhdG9yCgppZiB2YWxpZGF0b3IuZGVsZWdhdGVkQ291bnQgPT0gMAogICAgc3RhdGUuYWNjb3VudHNbc2VuZGVyXS5zdGF0dXMgPSBBY2NvdW50U3RhdHVzLk5vbmUKICAgIGRlbGV0ZSBzdGF0ZS5pbmFjdGl2ZVZhbGlkYXRvclNldFtzZW5kZXJdCgpzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQucHJvcG9zZXJCbG9ja1Jld2FyZCArPSB0aXBDb3N0KHR4LmZlZS50aXBSYXRlLCBieXRlc1BhaWQpCg=="}}),t._v(" "),a("h4",{attrs:{id:"signedtransactiondatacreatedelegation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactiondatacreatedelegation"}},[t._v("#")]),t._v(" SignedTransactionDataCreateDelegation")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.CreateDelegation")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(tx.amount, tx.fee.tipRate, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[tx.to].status")]),t._v(" == "),a("code",[t._v("AccountStatus.ValidatorQueued")]),t._v(" or "),a("code",[t._v("state.accounts[tx.to].status")]),t._v(" == "),a("code",[t._v("AccountStatus.ValidatorBonded")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[sender].status")]),t._v(" == "),a("code",[t._v("AccountStatus.None")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"c3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uYmFsYW5jZSAtPSB0b3RhbENvc3QodHguYW1vdW50LCB0eC5mZWUudGlwUmF0ZSwgYnl0ZXNQYWlkKQpzdGF0ZS5hY2NvdW50c1tzZW5kZXJdLnN0YXR1cyA9IEFjY291bnRTdGF0dXMuRGVsZWdhdGlvbkJvbmRlZAoKaWYgc3RhdGUuYWNjb3VudHNbdHgudG9dLnN0YXR1cyA9PSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvclF1ZXVlZAogICAgdmFsaWRhdG9yID0gc3RhdGUuaW5hY3RpdmVWYWxpZGF0b3JTZXRbdHgudG9dCmVsc2UgaWYgc3RhdGUuYWNjb3VudHNbdHgudG9dLnN0YXR1cyA9PSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvckJvbmRlZAogICAgdmFsaWRhdG9yID0gc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0W3R4LnRvXQoKZGVsZWdhdGlvbiA9IG5ldyBEZWxlZ2F0aW9uCmRlbGVnYXRpb24uc3RhdHVzID0gRGVsZWdhdGlvblN0YXR1cy5Cb25kZWQKZGVsZWdhdGlvbi52YWxpZGF0b3IgPSB0eC50bwpkZWxlZ2F0aW9uLnN0YWtlZEJhbGFuY2UgPSB0eC5hbW91bnQKZGVsZWdhdGlvbi5iZWdpbkVudHJ5ID0gdmFsaWRhdG9yLmxhdGVzdEVudHJ5CmRlbGVnYXRpb24uZW5kRW50cnkgPSBQZXJpb2RFbnRyeSgwKQpkZWxlZ2F0aW9uLnVuYm9uZGluZ0hlaWdodCA9IDAKCnZhbGlkYXRvci5sYXRlc3RFbnRyeSArPSBjb21wdXRlX25ld19lbnRyeSh2YWxpZGF0b3IucGVuZGluZ1Jld2FyZHMsIHZhbGlkYXRvci52b3RpbmdQb3dlcikKdmFsaWRhdG9yLnBlbmRpbmdSZXdhcmRzID0gMAp2YWxpZGF0b3IuZGVsZWdhdGVkQ291bnQgKz0gMQp2YWxpZGF0b3Iudm90aW5nUG93ZXIgKz0gdHguYW1vdW50CgojIFVwZGF0ZSB0aGUgdmFsaWRhdG9yIGluIHRoZSBsaW5rZWQgbGlzdCBieSBmaXJzdCByZW1vdmluZyB0aGVuIGluc2VydGluZwp2YWxpZGF0b3JRdWV1ZVJlbW92ZSh2YWxpZGF0b3IsIGRlbGVnYXRpb24udmFsaWRhdG9yKQp2YWxpZGF0b3JRdWV1ZUluc2VydCh2YWxpZGF0b3IpCgpzdGF0ZS5kZWxlZ2F0aW9uU2V0W3NlbmRlcl0gPSBkZWxlZ2F0aW9uCgppZiBzdGF0ZS5hY2NvdW50c1t0eC50b10uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yUXVldWVkCiAgICBzdGF0ZS5pbmFjdGl2ZVZhbGlkYXRvclNldFt0eC50b10gPSB2YWxpZGF0b3IKZWxzZSBpZiBzdGF0ZS5hY2NvdW50c1t0eC50b10uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yQm9uZGVkCiAgICBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXRbdHgudG9dID0gdmFsaWRhdG9yCiAgICBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQuYWN0aXZlVm90aW5nUG93ZXIgKz0gdHguYW1vdW50CgpzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQucHJvcG9zZXJCbG9ja1Jld2FyZCArPSB0aXBDb3N0KHR4LmZlZS50aXBSYXRlLCBieXRlc1BhaWQpCg=="}}),t._v(" "),a("h4",{attrs:{id:"signedtransactiondatabeginunbondingdelegation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactiondatabeginunbondingdelegation"}},[t._v("#")]),t._v(" SignedTransactionDataBeginUnbondingDelegation")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.BeginUnbondingDelegation")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(0, tx.fee.tipRate, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[sender].status")]),t._v(" == "),a("code",[t._v("AccountStatus.DelegationBonded")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"c3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uYmFsYW5jZSAtPSB0b3RhbENvc3QoMCwgdHguZmVlLnRpcFJhdGUsIGJ5dGVzUGFpZCkKc3RhdGUuYWNjb3VudHNbc2VuZGVyXS5zdGF0dXMgPSBBY2NvdW50U3RhdHVzLkRlbGVnYXRpb25VbmJvbmRpbmcKCmRlbGVnYXRpb24gPSBzdGF0ZS5kZWxlZ2F0aW9uU2V0W3NlbmRlcl0KCmlmIHN0YXRlLmFjY291bnRzW2RlbGVnYXRpb24udmFsaWRhdG9yXS5zdGF0dXMgPT0gQWNjb3VudFN0YXR1cy5WYWxpZGF0b3JRdWV1ZWQgfHwKICAgICAgc3RhdGUuYWNjb3VudHNbZGVsZWdhdGlvbi52YWxpZGF0b3JdLnN0YXR1cyA9PSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvclVuYm9uZGluZyB8fAogICAgICBzdGF0ZS5hY2NvdW50c1tkZWxlZ2F0aW9uLnZhbGlkYXRvcl0uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yVW5ib25kZWQKICAgIHZhbGlkYXRvciA9IHN0YXRlLmluYWN0aXZlVmFsaWRhdG9yU2V0W2RlbGVnYXRpb24udmFsaWRhdG9yXQplbHNlIGlmIHN0YXRlLmFjY291bnRzW2RlbGVnYXRpb24udmFsaWRhdG9yXS5zdGF0dXMgPT0gQWNjb3VudFN0YXR1cy5WYWxpZGF0b3JCb25kZWQKICAgIHZhbGlkYXRvciA9IHN0YXRlLmFjdGl2ZVZhbGlkYXRvclNldFtkZWxlZ2F0aW9uLnZhbGlkYXRvcl0KCmRlbGVnYXRpb24uc3RhdHVzID0gRGVsZWdhdGlvblN0YXR1cy5VbmJvbmRpbmcKZGVsZWdhdGlvbi5lbmRFbnRyeSA9IHZhbGlkYXRvci5sYXRlc3RFbnRyeQpkZWxlZ2F0aW9uLnVuYm9uZGluZ0hlaWdodCA9IGJsb2NrLmhlaWdodCArIDEKCnZhbGlkYXRvci5sYXRlc3RFbnRyeSArPSBjb21wdXRlX25ld19lbnRyeSh2YWxpZGF0b3IucGVuZGluZ1Jld2FyZHMsIHZhbGlkYXRvci52b3RpbmdQb3dlcikKdmFsaWRhdG9yLnBlbmRpbmdSZXdhcmRzID0gMAp2YWxpZGF0b3IuZGVsZWdhdGVkQ291bnQgLT0gMQp2YWxpZGF0b3Iudm90aW5nUG93ZXIgLT0gZGVsZWdhdGlvbi5zdGFrZWRCYWxhbmNlCgojIFVwZGF0ZSB0aGUgdmFsaWRhdG9yIGluIHRoZSBsaW5rZWQgbGlzdCBieSBmaXJzdCByZW1vdmluZyB0aGVuIGluc2VydGluZwojIE9ubHkgZG8gdGhpcyBpZiB0aGUgdmFsaWRhdG9yIGlzIGFjdHVhbGx5IGluIHRoZSBxdWV1ZSAoaS5lLiBib25kZWQgb3IgcXVldWVkKQppZiBzdGF0ZS5hY2NvdW50c1tkZWxlZ2F0aW9uLnZhbGlkYXRvcl0uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yQm9uZGVkIHx8CiAgICAgIHN0YXRlLmFjY291bnRzW2RlbGVnYXRpb24udmFsaWRhdG9yXS5zdGF0dXMgPT0gQWNjb3VudFN0YXR1cy5WYWxpZGF0b3JRdWV1ZWQKICAgIHZhbGlkYXRvclF1ZXVlUmVtb3ZlKHZhbGlkYXRvciwgZGVsZWdhdGlvbi52YWxpZGF0b3IpCiAgICB2YWxpZGF0b3JRdWV1ZUluc2VydCh2YWxpZGF0b3IpCgpzdGF0ZS5kZWxlZ2F0aW9uU2V0W3NlbmRlcl0gPSBkZWxlZ2F0aW9uCgppZiBzdGF0ZS5hY2NvdW50c1tkZWxlZ2F0aW9uLnZhbGlkYXRvcl0uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yUXVldWVkIHx8CiAgICAgIHN0YXRlLmFjY291bnRzW2RlbGVnYXRpb24udmFsaWRhdG9yXS5zdGF0dXMgPT0gQWNjb3VudFN0YXR1cy5WYWxpZGF0b3JVbmJvbmRpbmcgfHwKICAgICAgc3RhdGUuYWNjb3VudHNbZGVsZWdhdGlvbi52YWxpZGF0b3JdLnN0YXR1cyA9PSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvclVuYm9uZGVkCiAgICBzdGF0ZS5pbmFjdGl2ZVZhbGlkYXRvclNldFtkZWxlZ2F0aW9uLnZhbGlkYXRvcl0gPSB2YWxpZGF0b3IKZWxzZSBpZiBzdGF0ZS5hY2NvdW50c1tkZWxlZ2F0aW9uLnZhbGlkYXRvcl0uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yQm9uZGVkCiAgICBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXRbZGVsZWdhdGlvbi52YWxpZGF0b3JdID0gdmFsaWRhdG9yCiAgICBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQuYWN0aXZlVm90aW5nUG93ZXIgLT0gZGVsZWdhdGlvbi5zdGFrZWRCYWxhbmNlCgpzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQucHJvcG9zZXJCbG9ja1Jld2FyZCArPSB0aXBDb3N0KHR4LmZlZS50aXBSYXRlLCBieXRlc1BhaWQpCg=="}}),t._v(" "),a("h4",{attrs:{id:"signedtransactiondataunbonddelegation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactiondataunbonddelegation"}},[t._v("#")]),t._v(" SignedTransactionDataUnbondDelegation")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.UnbondDelegation")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(0, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[sender].status")]),t._v(" == "),a("code",[t._v("AccountStatus.DelegationUnbonding")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.delegationSet[sender].unbondingHeight + UNBONDING_DURATION")]),t._v(" < "),a("code",[t._v("block.height")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"ZGVsZWdhdGlvbiA9IHN0YXRlLmFjY291bnRzW3NlbmRlcl0uZGVsZWdhdGlvbkluZm8KCnN0YXRlLmFjY291bnRzW3NlbmRlcl0ubm9uY2UgKz0gMQpzdGF0ZS5hY2NvdW50c1tzZW5kZXJdLmJhbGFuY2UgLT0gdG90YWxDb3N0KDAsIHR4LmZlZS50aXBSYXRlLCBieXRlc1BhaWQpCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uc3RhdHVzID0gTm9uZQoKIyBSZXR1cm4gdGhlIGRlbGVnYXRlZCBzdGFrZQpzdGF0ZS5hY2NvdW50c1tzZW5kZXJdLmJhbGFuY2UgKz0gZGVsZWdhdGlvbi5zdGFrZWRCYWxhbmNlCiMgQWxzbyBkaXNwZXJzZSByZXdhcmRzIChjb21taXNzaW9uIGhhcyBhbHJlYWR5IGJlZW4gbGV2aWVkKQpzdGF0ZS5hY2NvdW50c1tzZW5kZXJdLmJhbGFuY2UgKz0gZGVsZWdhdGlvbi5zdGFrZWRCYWxhbmNlICogKGRlbGVnYXRpb24uZW5kRW50cnkgLSBkZWxlZ2F0aW9uLmJlZ2luRW50cnkpCgppZiBzdGF0ZS5hY2NvdW50c1tkZWxlZ2F0aW9uLnZhbGlkYXRvcl0uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yUXVldWVkIHx8CiAgICAgIHN0YXRlLmFjY291bnRzW2RlbGVnYXRpb24udmFsaWRhdG9yXS5zdGF0dXMgPT0gQWNjb3VudFN0YXR1cy5WYWxpZGF0b3JVbmJvbmRpbmcKICAgICAgc3RhdGUuYWNjb3VudHNbZGVsZWdhdGlvbi52YWxpZGF0b3JdLnN0YXR1cyA9PSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvclVuYm9uZGVkCiAgICB2YWxpZGF0b3IgPSBzdGF0ZS5pbmFjdGl2ZVZhbGlkYXRvclNldFtkZWxlZ2F0aW9uLnZhbGlkYXRvcl0KZWxzZSBpZiBzdGF0ZS5hY2NvdW50c1tkZWxlZ2F0aW9uLnZhbGlkYXRvcl0uc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yQm9uZGVkCiAgICB2YWxpZGF0b3IgPSBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXRbZGVsZWdhdGlvbi52YWxpZGF0b3JdCgppZiB2YWxpZGF0b3IuZGVsZWdhdGVkQ291bnQgPT0gMCAmYW1wOyZhbXA7CiAgICAgIHN0YXRlLmFjY291bnRzW2RlbGVnYXRpb24udmFsaWRhdG9yXS5zdGF0dXMgPT0gQWNjb3VudFN0YXR1cy5WYWxpZGF0b3JVbmJvbmRlZAogICAgc3RhdGUuYWNjb3VudHNbZGVsZWdhdGlvbi52YWxpZGF0b3JdLnN0YXR1cyA9IEFjY291bnRTdGF0dXMuTm9uZQogICAgZGVsZXRlIHN0YXRlLmluYWN0aXZlVmFsaWRhdG9yU2V0W2RlbGVnYXRpb24udmFsaWRhdG9yXQoKZGVsZXRlIHN0YXRlLmFjY291bnRzW3NlbmRlcl0uZGVsZWdhdGlvbkluZm8KCnN0YXRlLmFjdGl2ZVZhbGlkYXRvclNldC5wcm9wb3NlckJsb2NrUmV3YXJkICs9IHRpcENvc3QodHguZmVlLnRpcFJhdGUsIGJ5dGVzUGFpZCkK"}}),t._v(" "),a("h4",{attrs:{id:"signedtransactiondataburn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactiondataburn"}},[t._v("#")]),t._v(" SignedTransactionDataBurn")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.Burn")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(tx.amount, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"c3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uYmFsYW5jZSAtPSB0b3RhbENvc3QodHguYW1vdW50LCB0eC5mZWUudGlwUmF0ZSwgYnl0ZXNQYWlkKQoKc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0LnByb3Bvc2VyQmxvY2tSZXdhcmQgKz0gdGlwQ29zdCh0eC5mZWUudGlwUmF0ZSwgYnl0ZXNQYWlkKQo="}}),t._v(" "),a("h4",{attrs:{id:"signedtransactionredelegatecommission"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactionredelegatecommission"}},[t._v("#")]),t._v(" SignedTransactionRedelegateCommission")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.RedelegateCommission")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(0, tx.fee.tipRate, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[tx.to].status")]),t._v(" == "),a("code",[t._v("AccountStatus.DelegationBonded")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[sender].status")]),t._v(" == "),a("code",[t._v("AccountStatus.ValidatorBonded")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"c3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uYmFsYW5jZSAtPSB0b3RhbENvc3QoMCwgdHguZmVlLnRpcFJhdGUsIGJ5dGVzUGFpZCkKCmRlbGVnYXRpb24gPSBzdGF0ZS5kZWxlZ2F0aW9uU2V0W3R4LnRvXQp2YWxpZGF0b3IgPSBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXRbZGVsZWdhdGlvbi52YWxpZGF0b3JdCgojIEZvcmNlLXJlZGVsZWdhdGUgcGVuZGluZyByZXdhcmRzIGZvciBkZWxlZ2F0aW9uCnBlbmRpbmdSZXdhcmRzID0gZGVsZWdhdGlvbi5zdGFrZWRCYWxhbmNlICogKHZhbGlkYXRvci5sYXRlc3RFbnRyeSAtIGRlbGVnYXRpb24uYmVnaW5FbnRyeSkKZGVsZWdhdGlvbi5zdGFrZWRCYWxhbmNlICs9IHBlbmRpbmdSZXdhcmRzCmRlbGVnYXRpb24uYmVnaW5FbnRyeSA9IHZhbGlkYXRvci5sYXRlc3RFbnRyeQoKdmFsaWRhdG9yLmxhdGVzdEVudHJ5ICs9IGNvbXB1dGVfbmV3X2VudHJ5KHZhbGlkYXRvci5wZW5kaW5nUmV3YXJkcywgdmFsaWRhdG9yLnZvdGluZ1Bvd2VyKQp2YWxpZGF0b3IucGVuZGluZ1Jld2FyZHMgPSAwCgojIEFzc2lnbiBwZW5kaW5nIGNvbW1pc3Npb24gcmV3YXJkcyB0byBkZWxlZ2F0aW9uCmNvbW1pc3Npb25SZXdhcmRzID0gdmFsaWRhdG9yLmNvbW1pc3Npb25SZXdhcmRzCmRlbGVnYXRpb24uc3Rha2VkQmFsYW5jZSArPSBjb21taXNzaW9uUmV3YXJkcwp2YWxpZGF0b3IuY29tbWlzc2lvblJld2FyZHMgPSAwCgojIFVwZGF0ZSB2b3RpbmcgcG93ZXIKdmFsaWRhdG9yLnZvdGluZ1Bvd2VyICs9IHBlbmRpbmdSZXdhcmRzICsgY29tbWlzc2lvblJld2FyZHMKc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0LmFjdGl2ZVZvdGluZ1Bvd2VyICs9IHBlbmRpbmdSZXdhcmRzICsgY29tbWlzc2lvblJld2FyZHMKCnN0YXRlLmRlbGVnYXRpb25TZXRbdHgudG9dID0gZGVsZWdhdGlvbgpzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXRbZGVsZWdhdGlvbi52YWxpZGF0b3JdID0gdmFsaWRhdG9yCgpzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQucHJvcG9zZXJCbG9ja1Jld2FyZCArPSB0aXBDb3N0KHR4LmZlZS50aXBSYXRlLCBieXRlc1BhaWQpCg=="}}),t._v(" "),a("h4",{attrs:{id:"signedtransactionredelegatereward"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signedtransactionredelegatereward"}},[t._v("#")]),t._v(" SignedTransactionRedelegateReward")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"Ynl0ZXNQYWlkID0gbGVuKHR4KQo="}}),t._v(" "),a("p",[t._v("The following checks must be "),a("code",[t._v("true")]),t._v(":")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("tx.type")]),t._v(" == "),a("RouterLink",{attrs:{to:"/specs/data_structures.html#signedtransactiondata"}},[a("code",[t._v("TransactionType.RedelegateReward")])]),t._v(".")],1),t._v(" "),a("li",[a("code",[t._v("totalCost(0, tx.fee.tipRate, bytesPaid)")]),t._v(" <= "),a("code",[t._v("state.accounts[sender].balance")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("tx.nonce")]),t._v(" == "),a("code",[t._v("state.accounts[sender].nonce + 1")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[sender].status")]),t._v(" == "),a("code",[t._v("AccountStatus.DelegationBonded")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("state.accounts[state.delegationSet[sender].validator].status")]),t._v(" == "),a("code",[t._v("AccountStatus.ValidatorBonded")]),t._v(".")])]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"c3RhdGUuYWNjb3VudHNbc2VuZGVyXS5ub25jZSArPSAxCnN0YXRlLmFjY291bnRzW3NlbmRlcl0uYmFsYW5jZSAtPSB0b3RhbENvc3QoMCwgdHguZmVlLnRpcFJhdGUsIGJ5dGVzUGFpZCkKCmRlbGVnYXRpb24gPSBzdGF0ZS5kZWxlZ2F0aW9uU2V0W3NlbmRlcl0KdmFsaWRhdG9yID0gc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0W2RlbGVnYXRpb24udmFsaWRhdG9yXQoKIyBSZWRlbGVnYXRlIHBlbmRpbmcgcmV3YXJkcyBmb3IgZGVsZWdhdGlvbgpwZW5kaW5nUmV3YXJkcyA9IGRlbGVnYXRpb24uc3Rha2VkQmFsYW5jZSAqICh2YWxpZGF0b3IubGF0ZXN0RW50cnkgLSBkZWxlZ2F0aW9uLmJlZ2luRW50cnkpCmRlbGVnYXRpb24uc3Rha2VkQmFsYW5jZSArPSBwZW5kaW5nUmV3YXJkcwpkZWxlZ2F0aW9uLmJlZ2luRW50cnkgPSB2YWxpZGF0b3IubGF0ZXN0RW50cnkKCnZhbGlkYXRvci5sYXRlc3RFbnRyeSArPSBjb21wdXRlX25ld19lbnRyeSh2YWxpZGF0b3IucGVuZGluZ1Jld2FyZHMsIHZhbGlkYXRvci52b3RpbmdQb3dlcikKdmFsaWRhdG9yLnBlbmRpbmdSZXdhcmRzID0gMAoKIyBVcGRhdGUgdm90aW5nIHBvd2VyCnZhbGlkYXRvci52b3RpbmdQb3dlciArPSBwZW5kaW5nUmV3YXJkcwpzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQuYWN0aXZlVm90aW5nUG93ZXIgKz0gcGVuZGluZ1Jld2FyZHMKCnN0YXRlLmRlbGVnYXRpb25TZXRbc2VuZGVyXSA9IGRlbGVnYXRpb24Kc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0W2RlbGVnYXRpb24udmFsaWRhdG9yXSA9IHZhbGlkYXRvcgoKc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0LnByb3Bvc2VyQmxvY2tSZXdhcmQgKz0gdGlwQ29zdCh0eC5mZWUudGlwUmF0ZSwgYnl0ZXNQYWlkKQo="}}),t._v(" "),a("h4",{attrs:{id:"begin-block"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#begin-block"}},[t._v("#")]),t._v(" Begin Block")]),t._v(" "),a("p",[t._v("At the beginning of the block, rewards are distributed to the block proposer.")]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"cHJvcG9zZXIgPSBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXRbYmxvY2suaGVhZGVyLnByb3Bvc2VyQWRkcmVzc10KCiMgQ29tcHV0ZSBibG9jayBzdWJzaWR5IGFuZCBzYXZlIHRvIHN0YXRlIGZvciB1c2UgaW4gZW5kIGJsb2NrLgpyZXdhcmRGYWN0b3IgPSAoVEFSR0VUX0FOTlVBTF9JU1NVQU5DRSAqIEJMT0NLX1RJTUUpIC8gKFNFQ09ORFNfUEVSX1lFQVIgKiBzcXJ0KEdFTkVTSVNfQ09JTl9DT1VOVCkpCmJsb2NrUmV3YXJkID0gcmV3YXJkRmFjdG9yICogc3FydChzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQuYWN0aXZlVm90aW5nUG93ZXIpCnN0YXRlLmFjdGl2ZVZhbGlkYXRvclNldC5wcm9wb3NlckJsb2NrUmV3YXJkID0gYmxvY2tSZXdhcmQKCiMgU2F2ZSBwcm9wb3NlcidzIGluaXRpYWwgdm90aW5nIHBvd2VyIHRvIHN0YXRlIGZvciB1c2UgaW4gZW5kIGJsb2NrLgpzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQucHJvcG9zZXJJbml0aWFsVm90aW5nUG93ZXIgPSBwcm9wb3Nlci52b3RpbmdQb3dlcgoKc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0W2Jsb2NrLmhlYWRlci5wcm9wb3NlckFkZHJlc3NdID0gcHJvcG9zZXIK"}}),t._v(" "),a("h4",{attrs:{id:"end-block"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#end-block"}},[t._v("#")]),t._v(" End Block")]),t._v(" "),a("p",[t._v("Apply the following to the state:")]),t._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"py",base64:"YWNjb3VudCA9IHN0YXRlLmFjY291bnRzW2Jsb2NrLmhlYWRlci5wcm9wb3NlckFkZHJlc3NdCgppZiBhY2NvdW50LnN0YXR1cyA9PSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvclVuYm9uZGluZwogICAgICBhY2NvdW50LnN0YXR1cyA9PSBBY2NvdW50U3RhdHVzLlZhbGlkYXRvclVuYm9uZGVkCiAgICBwcm9wb3NlciA9IHN0YXRlLmluYWN0aXZlVmFsaWRhdG9yU2V0W2Jsb2NrLmhlYWRlci5wcm9wb3NlckFkZHJlc3NdCmVsc2UgaWYgYWNjb3VudC5zdGF0dXMgPT0gQWNjb3VudFN0YXR1cy5WYWxpZGF0b3JCb25kZWQKICAgIHByb3Bvc2VyID0gc3RhdGUuYWN0aXZlVmFsaWRhdG9yU2V0W2Jsb2NrLmhlYWRlci5wcm9wb3NlckFkZHJlc3NdCgojIEZsdXNoIHRoZSBvdXRzdGFuZGluZyBwZW5kaW5nIHJld2FyZHMuCnByb3Bvc2VyLmxhdGVzdEVudHJ5ICs9IGNvbXB1dGVfbmV3X2VudHJ5KHByb3Bvc2VyLnBlbmRpbmdSZXdhcmRzLCBwcm9wb3Nlci52b3RpbmdQb3dlcikKcHJvcG9zZXIucGVuZGluZ1Jld2FyZHMgPSAwCgpibG9ja1Jld2FyZCA9IHN0YXRlLmFjdGl2ZVZhbGlkYXRvclNldC5wcm9wb3NlckJsb2NrUmV3YXJkCmNvbW1pc3Npb25SZXdhcmQgPSBwcm9wb3Nlci5jb21taXNzaW9uUmF0ZS5udW1lcmF0b3IgKiBibG9ja1Jld2FyZCAvLyBwcm9wb3Nlci5jb21taXNzaW9uUmF0ZS5kZW5vbWluYXRvcgpwcm9wb3Nlci5jb21taXNzaW9uUmV3YXJkcyArPSBjb21taXNzaW9uUmV3YXJkCnByb3Bvc2VyLnBlbmRpbmdSZXdhcmRzICs9IGJsb2NrUmV3YXJkIC0gY29tbWlzc2lvblJld2FyZAoKIyBFdmVuIHRob3VnaCB0aGUgdm90aW5nIHBvd2VyIGhhc24ndCBjaGFuZ2VkIHlldCwgd2UgY29uc2lkZXIgdGhpcyBhIHBlcmlvZCBjaGFuZ2UuCnByb3Bvc2VyLmxhdGVzdEVudHJ5ICs9IGNvbXB1dGVfbmV3X2VudHJ5KHByb3Bvc2VyLnBlbmRpbmdSZXdhcmRzLCBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXQucHJvcG9zZXJJbml0aWFsVm90aW5nUG93ZXIpCnByb3Bvc2VyLnBlbmRpbmdSZXdhcmRzID0gMAoKaWYgYWNjb3VudC5zdGF0dXMgPT0gQWNjb3VudFN0YXR1cy5WYWxpZGF0b3JVbmJvbmRpbmcKICAgICAgYWNjb3VudC5zdGF0dXMgPT0gQWNjb3VudFN0YXR1cy5WYWxpZGF0b3JVbmJvbmRlZAogICAgc3RhdGUuaW5hY3RpdmVWYWxpZGF0b3JTZXRbYmxvY2suaGVhZGVyLnByb3Bvc2VyQWRkcmVzc10gPSBwcm9wb3NlcgplbHNlIGlmIGFjY291bnQuc3RhdHVzID09IEFjY291bnRTdGF0dXMuVmFsaWRhdG9yQm9uZGVkCiAgICBzdGF0ZS5hY3RpdmVWYWxpZGF0b3JTZXRbYmxvY2suaGVhZGVyLnByb3Bvc2VyQWRkcmVzc10gPSBwcm9wb3Nlcgo="}}),t._v(" "),a("p",[t._v("At the end of a block, the top "),a("code",[t._v("MAX_VALIDATORS")]),t._v(" validators by voting power with voting power "),a("em",[t._v("greater than")]),t._v(" zero are or become active (bonded). For newly-bonded validators, the entire validator object is moved to the active validators subtree and their status is changed to bonded. For previously-bonded validators that are no longer in the top "),a("code",[t._v("MAX_VALIDATORS")]),t._v(" validators begin unbonding.")]),t._v(" "),a("p",[t._v("Bonding validators is simply setting their status to "),a("code",[t._v("AccountStatus.ValidatorBonded")]),t._v(". The logic for validator unbonding is found "),a("a",{attrs:{href:"#signedtransactiondatabeginunbondingvalidator"}},[t._v("here")]),t._v(", minus transaction sender updates (nonce, balance, and fee).")]),t._v(" "),a("p",[t._v("Finally, the state subtree with ID "),a("a",{attrs:{href:"#reserved-state-subtree-ids"}},[a("code",[t._v("MESSAGE_PAID_SUBTREE_ID")])]),t._v(" is deleted.")]),t._v(" "),a("p",[t._v("This end block implicit state transition is a single state transition, and "),a("a",{attrs:{href:"#blockavailabledata"}},[t._v("only has a single intermediate state root")]),t._v(" associated with it.")])],1)}),[],!1,null,null,null);e.default=s.exports}}]);